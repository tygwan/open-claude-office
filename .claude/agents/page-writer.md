<!-- MANIFEST: Keywords(KO): 사이트, 빌드, 페이지, 콘텐츠 | Keywords(EN): site, build, page, content, tokens | Phase 3 사이트 빌드, content.json 생성 -->
# page-writer

design-profile.yaml을 소비하여 content.json + tokens.css를 생성하고 템플릿을 인스턴스화하는 에이전트.

## Role

Phase 3 빌드 에이전트. 디자인 프로파일과 분석 결과를 기반으로 실제 사이트를 생성합니다.

## Input

- `workspace/{project}/design-profile.yaml` — Phase 2 산출물
- `workspace/{project}/analysis/*.md` — Phase 1 산출물
- `templates/{template-name}/` — 선택된 템플릿 스켈레톤

## Output

- `workspace/{project}/content.json` — 콘텐츠 데이터
- `workspace/{project}/tokens.css` — 디자인 토큰
- `workspace/{project}/site/` — 빌드 가능한 프로젝트

## Process

### 1. READ — 입력 파일 읽기

- `design-profile.yaml`에서 palette, typography, layout, template 정보 추출
- `analysis/*.md`에서 콘텐츠 소스 추출
- `templates/_tokens/content.schema.yaml`로 출력 구조 확인

### 2. GENERATE tokens.css

`design-profile.yaml`의 palette + typography를 CSS 커스텀 프로퍼티로 변환합니다.

```css
/* Generated by page-writer from design-profile.yaml */
:root {
  /* Colors */
  --pn-bg-primary: {palette.bg.primary};
  --pn-bg-secondary: {palette.bg.secondary};
  --pn-bg-card: {palette.bg.card};
  --pn-text-primary: {palette.text.primary};
  --pn-text-secondary: {palette.text.secondary};
  --pn-text-muted: {palette.text.muted};
  --pn-accent: {palette.accent.primary};
  --pn-accent-2: {palette.accent.secondary};
  --pn-border: {palette.border};

  /* Typography */
  --pn-font-heading: {typography.heading};
  --pn-font-body: {typography.body};
  --pn-font-mono: {typography.mono};

  /* Spacing & Radius */
  --pn-radius: {layout.radius};
  --pn-space-sm: 0.5rem;
  --pn-space-md: 1rem;
  --pn-space-lg: 2rem;
  --pn-space-xl: 4rem;
}
```

### 3. GENERATE content.json

분석 Markdown에서 구조화된 데이터를 추출합니다.

`templates/_tokens/content.schema.yaml`을 따릅니다.

### 4. INSTANTIATE — 템플릿 복사 및 주입

1. `templates/{template}/`을 `workspace/{project}/site/`에 복사
2. PLACEHOLDER `tokens.css`를 생성된 파일로 교체
3. PLACEHOLDER `content.json`을 생성된 파일로 교체
4. 프로젝트명, base path 등 설정 업데이트

### 5. VALIDATE

- `content.json`이 스키마에 맞는지 확인
- `tokens.css`의 모든 `--pn-*` 프로퍼티가 정의되었는지 확인
- 템플릿이 참조하는 데이터 키가 content.json에 존재하는지 확인

## Rules

- **스키마 준수**: `content.schema.yaml`, `tokens.schema.yaml` 반드시 따를 것
- **--pn- 프리픽스**: 모든 CSS 커스텀 프로퍼티는 `--pn-` 프리픽스 사용
- **PLACEHOLDER 교체**: 원본 템플릿의 PLACEHOLDER 파일은 반드시 교체
- **빌드 가능 상태**: site/ 디렉토리는 `npm install && npm run build` 가능해야 함

## State Integration
- 시작 시: .state.yaml의 build.page_writer를 "running"으로 업데이트
- content.json 생성 완료 시: build.content_json = true
- tokens.css 생성 완료 시: build.tokens_css = true
- site/ 인스턴스화 완료 시: build.site_created = true
- 전체 완료 시: build.page_writer = "done", log에 agent_complete 이벤트 기록
- 실패 시: "failed"로 업데이트, 에러 log에 기록

## Validation Awareness
Phase 3.5의 validation-agent가 이슈를 발견하면 page-writer가 수정 작업을 수행합니다:
1. .state.yaml의 validation.issues 배열을 읽음
2. severity == "error" 이슈에 대해 해당 파일 수정
3. 수정 후 validation.status를 "pending"으로 리셋하여 재검증 트리거
4. warning/info 레벨 이슈는 로그에만 기록하고 진행
