# DXTnavis - Project Narrative

> Generated by story-analyst | 2026-02-22
> Source: /home/coffin/dev/DXTnavis

---

## Project Origin & Purpose

DXTnavis was born from a practical need in the construction/BIM (Building Information Modeling) industry: the ability to efficiently inspect, filter, export, and automate 4D simulation workflows within Autodesk Navisworks 2025. The plugin addresses a gap where Navisworks' built-in property inspection tools are limited, and creating 4D construction schedules (TimeLiner tasks linked to 3D model objects) is a manual, error-prone process.

The project name "DXTnavis" combines "DXT" (a project/team identifier) with "navis" (from Navisworks), signaling its identity as a dedicated Navisworks enhancement tool.

Developer: Yoon Taegwan, with AI assistance from Claude (Anthropic).

Evidence: `README.md:1-5`, `DX.cs:8-9` ("Navisworks property viewer plugin"), initial commit `e43200a` (2026-01-06).

---

## Evolution Timeline

### Phase 0: Genesis (2025-12-29 to 2026-01-05)

The project began with a basic scaffold on 2025-12-29 (`CHANGELOG.md:523-530`, version 0.0.1). The first functional commit on 2026-01-06 (`e43200a`) already included a working plugin entry point, basic WPF UI, and snapshot capture functionality. This suggests significant pre-commit prototyping.

### Phase 1-4: Core Foundation (2026-01-03 to 2026-01-06)

In just 3 days, four foundational features shipped:
- **v0.1.0** (Jan 3): Level/SysPath filtering, TreeView hierarchy, visual level badges
- **v0.2.0** (Jan 5): 3D selection, visibility control, zoom
- **v0.3.0** (Jan 6): Level-based tree expand/collapse
- Phase 4: Snapshot capture workflow

This rapid cadence (one version per day) indicates a developer highly familiar with the Navisworks API and a clear vision for the product.

Evidence: Commits `e43200a` through `4a203ca`, `CHANGELOG.md:481-520`

### Phase 5: Code Quality & Research (2026-01-09)

A pivotal day where the codebase matured:
- The 2,213-line monolithic ViewModel was split into 7 partial classes (commit `da035ee`)
- CSV Viewer feature added
- ComAPI Property Write research completed (ADR-001)
- This was a deliberate investment in maintainability before the ambitious Phase 8

Evidence: `CHANGELOG.md:345-377`, commits `da035ee`, `001acf9`

### Phase 6-8: AWP 4D Automation (2026-01-11)

The most architecturally significant milestone: a complete 5-phase automation pipeline (CSV->Match->Write->Set->TimeLiner) in a single commit (`efcd237`). This created 7 new service classes and 4 new model classes. The pipeline includes validation, dry run, progress tracking, and error recovery.

Evidence: `CHANGELOG.md:312-341`, `Services/AWP4DAutomationService.cs:1-420`

### Phase 9-12: UI & Performance (2026-01-13 to 2026-01-20)

Focused on handling real-world BIM data scale:
- **Phase 9 (v0.9.0)**: Object grouping MVP with Expander UI
- **Phase 10 (v0.8.0)**: Async loading with progress
- **Phase 11**: Object grouping refinement
- **Phase 12 (v1.0.0)**: Complete data structure refactoring from 445K records to ~5K groups

The Phase 12 refactoring was a critical performance breakthrough, reducing Select All iterations by 99%.

Evidence: `CHANGELOG.md:237-264`, commit `f070dd1`, `3ebc3f4`

### Phase 13-14: TimeLiner Enhancement & Direct Execution (2026-01-21)

Streamlined the workflow from 7 steps to 3 steps:
- Direct TimeLiner execution without CSV intermediary
- TaskType Korean/English localization
- Extended ParentSet strategies (7 strategies including composite)

Evidence: `CHANGELOG.md:171-233`, commit `83b347b`

### Phase 15-16: Geometry & Ontology Bridge (2026-02-06)

The latest frontier: exporting BIM geometry data (BoundingBox, Centroid, Mesh) for integration with external 3D viewers (Three.js, CesiumJS, deck.gl) and knowledge graph systems:
- Phase 15: Geometry Export System with manifest.json + CSV
- Phase 16: Unified CSV Export merging hierarchy + geometry for ontology conversion

Evidence: `CHANGELOG.md:10-97`, commits `ba2a33a`, `35dabdf`

---

## Key Milestones

### Milestone 1: AWP 4D Automation Pipeline (2026-01-11)

- **Date**: January 11, 2026
- **Version**: v0.6.0
- **Impact**: Transformed the plugin from a passive viewer into an active automation tool
- **What**: Complete 5-phase pipeline: CSV Import -> Object Matching -> Property Write -> Selection Set -> TimeLiner Task
- **Significance**: This was the project's inflection point. Prior versions were read-only tools; v0.6.0 could modify the Navisworks model, create hierarchical selection sets, and auto-generate 4D simulation tasks.
- **Evidence**: Commit `efcd237`, `CHANGELOG.md:312-341`, `Services/AWP4DAutomationService.cs`

### Milestone 2: Grouped Data Structure Refactoring (2026-01-20)

- **Date**: January 20, 2026
- **Version**: v1.0.0
- **Impact**: Solved the 445K-record performance wall, enabling the plugin to handle production BIM models
- **What**: Replaced flat record-based data structure with grouped object model (445K -> ~5K groups)
- **Significance**: The 1.0.0 version number reflects its importance. Without this optimization, the plugin was impractical for real-world models with hundreds of thousands of properties.
- **Evidence**: `CHANGELOG.md:237-264`, `Models/ObjectGroupModel.cs`, `NavisworksDataExtractor.cs:617-843`

### Milestone 3: Geometry Export for 3D/Ontology Integration (2026-02-06)

- **Date**: February 6, 2026
- **Version**: v1.4.0
- **Impact**: Opened the bridge between BIM data and external visualization/knowledge systems
- **What**: BoundingBox extraction, manifest.json (Three.js/CesiumJS compatible), Unified CSV export, RDF geometry integration
- **Significance**: Moves the project beyond Navisworks-only workflows toward a data integration hub. The unified CSV enables the companion `bim-ontology` project for knowledge graph construction.
- **Evidence**: `CHANGELOG.md:10-97`, `Services/Geometry/GeometryExtractor.cs`, `Services/UnifiedCsvExporter.cs`

### Milestone 4: Direct TimeLiner Execution (2026-01-21)

- **Date**: January 21, 2026
- **Version**: v1.2.0
- **Impact**: 57% workflow reduction (7 steps -> 3 steps) for 4D simulation setup
- **What**: Eliminated CSV intermediate step; direct object selection -> configuration -> TimeLiner execution
- **Significance**: Demonstrates user-centric iteration. The initial pipeline required CSV export/import; this version provides one-click automation.
- **Evidence**: `CHANGELOG.md:171-198`, `ViewModels/ScheduleBuilderViewModel.cs:751-926`

---

## Technical Challenges Solved

### Challenge 1: .NET API Read-Only Limitation

- **Problem**: Navisworks .NET API does not support writing custom properties to model objects. This blocked the entire 4D automation workflow.
- **Solution**: Discovered and implemented COM API bridge (`ComApiBridge.State`, `InwGUIPropertyNode2.SetUserDefined()`) with retry logic for COM exceptions.
- **Evidence**: `Services/PropertyWriteService.cs:88-133`, `docs/adr/ADR-001-ComAPI-Property-Write.md`

### Challenge 2: AccessViolationException in Property Extraction

- **Problem**: Navisworks API randomly throws `System.AccessViolationException` when accessing certain property categories, crashing the plugin.
- **Solution**: Applied `[HandleProcessCorruptedStateExceptions]` and `[SecurityCritical]` attributes, wrapped every property access in try-catch, and implemented graceful skip-and-continue logic.
- **Evidence**: `Services/NavisworksDataExtractor.cs:30-31`, `Services/NavisworksDataExtractor.cs:87-102`

### Challenge 3: 445K Record Performance Wall

- **Problem**: Real BIM models contain 400K+ individual property records. WPF ObservableCollection and data binding collapsed under this volume (frozen UI, minutes-long Select All).
- **Solution**: Redesigned data model from flat records to grouped objects (1 object = 1 group with N properties). Reduced iteration from 445K to ~5K for all bulk operations.
- **Evidence**: `Models/ObjectGroupModel.cs`, `CHANGELOG.md:237-264`, Phase 12 refactoring

### Challenge 4: UI Thread Safety with Navisworks API

- **Problem**: Navisworks API calls must execute on the UI thread. Using `Task.Run()` for async operations caused `InvalidOperationException` and crashes.
- **Solution**: Removed `Task.Run()` from hierarchy loading, executed all Navisworks API calls synchronously on the UI thread, used debounce timers for responsiveness.
- **Evidence**: `DXwindowViewModel.cs:1455-1457` (Error7 comment), commit `0c6edcd` ("resolve UI freeze by removing Task.Run")

### Challenge 5: InstanceGuid Unavailability in Some BIM Formats

- **Problem**: CATIA, PDMS, and some imported models have `Guid.Empty` for InstanceGuid, breaking parent-child hierarchy and ontology mapping.
- **Solution**: Implemented synthetic ID generation with deterministic GUID creation using MD5 hash of (ModelSourceGuid + AuthoringID or HierarchyPath).
- **Evidence**: `Services/Geometry/GeometryExtractor.cs:271-404`, `CHANGELOG.md:113-147`

---

## Impact & Value Proposition

### For BIM Engineers

1. **Property inspection at scale**: Filter and search through 400K+ properties with responsive UI (vs. Navisworks native inspector limited to single-object view)
2. **One-click 4D simulation**: From object selection to full TimeLiner setup in 3 steps (vs. manual 7+ step process per task)
3. **Data export pipeline**: Raw + Refined CSV dual export with encoding auto-detection for Korean/English mixed data

### For Construction Managers

1. **Schedule automation**: CSV schedule data automatically linked to 3D objects with validation and dry run
2. **Visual verification**: 3D highlighting, Show Only, Zoom for quick spatial verification of schedule assignments

### For Researchers / Data Scientists

1. **Geometry data bridge**: BoundingBox/Centroid export in manifest.json (Three.js/CesiumJS/deck.gl compatible)
2. **Unified CSV**: Single-file export merging hierarchy, properties, and geometry for knowledge graph construction
3. **Ontology ready**: RDF/TTL geometry integration with BSO/GeoSPARQL vocabularies

---

## Current Status & Roadmap

### Current: v1.4.0 (Released 2026-02-06)

- 16 development phases completed
- Fully functional plugin deployed to Navisworks 2025
- Astro portfolio site deployed to GitHub Pages

### Planned / In Progress

| Item | Status | Evidence |
|------|--------|----------|
| Phase 14: Ontology (dotNetRdf/Neo4j) | Disabled - assembly loading conflict | `DXTnavis.csproj:127-160` |
| Phase 15.3: COM Mesh Export (GLB/OBJ) | Implemented, needs testing | `Services/Geometry/MeshExtractor.cs` |
| Mesh storage analysis | Research phase | Commit `5be1934` |
| bim-ontology integration | Active (companion project) | `workspace/bim-ontology/` in open-pantheon |

---

## Story Summary

DXTnavis tells the story of solving a real construction industry problem: making BIM data actionable rather than passive. In 44 days of intensive development, it evolved from a simple property viewer into a comprehensive automation platform that can:

1. **Read** 445K+ properties from any Navisworks model with graceful error handling
2. **Group** them into ~5K manageable objects with instant filtering
3. **Write** schedule data back to model objects via COM API
4. **Create** hierarchical selection sets and TimeLiner tasks automatically
5. **Export** geometry data for 3D visualization and knowledge graph systems

The technical narrative is one of progressive problem-solving: each phase addressed a specific limitation, from API read-only constraints to performance walls to format compatibility issues. The consistent theme is pragmatism -- choosing solutions that work within Navisworks' constraints rather than fighting them.
